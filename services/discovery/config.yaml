server:
  host: "0.0.0.0"
  port: 8080
  read_timeout: 30s
  write_timeout: 30s
  idle_timeout: 120s

elasticsearch:
  addresses:
    - "http://elasticsearch:9200"
  username: "elastic"
  password: "${ELASTICSEARCH_PASSWORD}"
  index_name: "llm_services"
  max_retries: 3
  retry_backoff: 1s
  enable_metrics: true

  # Index settings
  shards: 3
  replicas: 1
  refresh_interval: "1s"

  # Vector search configuration
  vector_dimensions: 768  # For sentence-transformers/all-mpnet-base-v2
  similarity: "cosine"

redis:
  address: "redis:6379"
  password: "${REDIS_PASSWORD}"
  db: 0
  max_retries: 3
  pool_size: 100
  min_idle_conns: 10

  # Cache TTL configurations
  cache_ttl:
    search_results: 30s
    service_details: 5m
    categories: 1h
    tags: 1h
    recommendations: 2m

postgres:
  host: "postgres"
  port: 5432
  database: "marketplace"
  user: "marketplace"
  password: "${POSTGRES_PASSWORD}"
  ssl_mode: "require"
  max_open_conns: 100
  max_idle_conns: 10
  conn_max_lifetime: 1h

# Embedding service for semantic search
embedding_service:
  url: "http://embedding-service:8000"
  model: "sentence-transformers/all-mpnet-base-v2"
  timeout: 5s
  batch_size: 32

# Search configuration
search:
  max_results: 100
  default_results: 20

  # Ranking weights (must sum to 1.0)
  ranking_weights:
    relevance: 0.4
    popularity: 0.2
    performance: 0.2
    compliance: 0.2

  # Fuzzy matching
  fuzzy_enabled: true
  fuzzy_distance: 2

  # Semantic search
  semantic_enabled: true
  semantic_threshold: 0.7
  hybrid_alpha: 0.5  # 0.5 = equal weight to text and semantic

# Recommendation engine
recommendations:
  enabled: true
  max_recommendations: 10

  # Algorithm weights
  collaborative_weight: 0.4
  content_weight: 0.3
  popularity_weight: 0.3

  # Collaborative filtering
  min_common_users: 3
  similarity_threshold: 0.6

  # Trending
  trending_window: 24h
  trending_min_interactions: 10

# Performance targets
performance:
  target_p95_latency_ms: 200
  target_p99_latency_ms: 500
  max_concurrent_requests: 10000
  circuit_breaker_threshold: 0.5
  circuit_breaker_timeout: 30s

# Observability
observability:
  metrics:
    enabled: true
    port: 9090
    path: "/metrics"
    collect_interval: 15s

  tracing:
    enabled: true
    exporter: "jaeger"
    jaeger_endpoint: "http://jaeger:14268/api/traces"
    sampling_rate: 0.1  # 10% of requests

  logging:
    level: "info"  # debug, info, warn, error
    format: "json"
    output: "stdout"

# Policy engine integration
policy_engine:
  grpc_endpoint: "policy-engine:50051"
  timeout: 5s
  cache_ttl: 5m

# Analytics hub integration
analytics_hub:
  kafka_brokers:
    - "kafka:9092"
  topic: "marketplace.search.events"
  batch_size: 100
  flush_interval: 5s
